(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const i of c.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(o){if(o.ep)return;o.ep=!0;const c=n(o);fetch(o.href,c)}})();fetch("/partials/head.html").then(e=>e.text()).then(e=>document.head.innerHTML+=e);function b(){window.location.href="/login.html"}function E(){const t=document.getElementById("modalTemplate").content.cloneNode(!0),n=document.createElement("div");n.appendChild(t);const r=n.querySelector(".m-modal");return r.querySelector('button[data-action="close"]').addEventListener("click",c=>{r.remove()}),r}function u(e){const t=E();document.body.after(t);const n=t.querySelector('p[data-txt="result"]');n.textContent=e.message}async function _(){try{if(!(await fetch("http://localhost:8080/api/logout",{method:"POST",credentials:"include"})).ok)throw new Error("ログアウトに失敗しました");console.log("ログアウト API通信成功"),b()}catch(e){u(e)}}function F(){const e=document.getElementById("logoutBtn");console.log(e),e&&e.addEventListener("click",t=>{t.preventDefault(),console.log("ログアウトボタンクリック"),_()})}async function I(e,t,n){const r=document.querySelector(e);if(!r)return;const c=await(await fetch(t)).text();r.innerHTML=c,typeof n=="function"&&n()}I("#header","/partials/header.html");I("#footer","/partials/footer.html",()=>{F()});function P(){document.getElementById("userRegisterForm").reset(),document.getElementById("userRegisterSuccess").classList.add("is-active"),document.getElementById("userRegisterDefault").classList.add("is-hidden")}async function A(e,t,n,r){try{if(!(await fetch("http://localhost:8080/api/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,email:t,password:n,confirmPassword:r})})).ok)throw new Error("ユーザーの削除に失敗しました");console.log("[完了]ユーザー新規登録"),P()}catch(o){u(o)}}function R(){window.location.href="/fridges.html"}async function N(e,t){try{if(!(await fetch("http://localhost:8080/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t}),credentials:"include"})).ok)throw new Error("ログインに失敗しました");R()}catch(n){u(n)}}function U(){const t=document.getElementById("userShareTemplate").content.cloneNode(!0),n=document.createElement("div");return n.appendChild(t),n.querySelector(".m-share-add")}function D(){if(window.location.pathname!=="/userShare.html")return;const e=document.getElementById("txtShareFridgeName");if(!e)return;const n=new URLSearchParams(window.location.search).get("fridgeName");e.textContent=n}D();function $(e,t){const n=E();e.after(n);const r=n.querySelector('p[data-txt="result"]');r.textContent=`${t} に共有しました`,e.remove()}async function T(e,t){const r=new URLSearchParams(window.location.search).get("fridgeId");try{if(!(await fetch(`http://localhost:8080/api/fridges/${r}/share`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t}),credentials:"include"})).ok)throw new Error(msg);$(e,t)}catch(o){u(o)}}function O(e){const t=e.querySelector('[data-text="userName"]').textContent;T(e,t)}function j(){const e=document.querySelectorAll(".m-share-add");e.length&&e.forEach(t=>{t.querySelector('button[data-action="share"]').addEventListener("click",r=>{r.preventDefault(),O(t)})})}function J(e){const t=U(),n=t.querySelector('[data-text="userName"]');n.textContent=e,document.getElementById("usersSearchForm").after(t),document.getElementById("usersSearchForm").reset(),j()}async function M(e){console.log(e);try{const t=await fetch(`http://localhost:8080/api/users/search?email=${encodeURIComponent(e)}`,{credentials:"include"});if(!t.ok)throw new Error("ユーザーが見つかりません");const r=(await t.json()).email;J(r)}catch(t){u(t)}}async function V(e,t){try{if(!(await fetch(`http://localhost:8080/api/fridges/${e}/users/${t}`,{method:"DELETE",credentials:"include"})).ok)throw new Error("ユーザーの削除に失敗しました");console.log("[完了]ユーザー削除")}catch(n){u(n)}}function z(){return document.getElementById("fridgeBoxTemplate").content.cloneNode(!0).querySelector("li")}function H(e){const t=document.getElementById("fridgeList");t.innerHTML="",e.length&&e.forEach(n=>{const r=z();r.setAttribute("id","fridge-"+n.id);const o=r.querySelector('input[name="fridgeRemoveCheck"]');o.value=n.id;const c=r.querySelector(".m-fridge__name");c.textContent=n.name;const i=r.querySelector(".m-fridge__contents");Array.isArray(n.items)&&n.items.length>0&&n.items.slice(0,5).forEach(d=>{const l=document.createElement("li"),g=document.createElement("span");l.textContent=d.name,l.prepend(g),d.category==="野菜・果物"?l.classList.add("m-fridge__content--vege"):d.category==="肉・魚"?l.classList.add("m-fridge__content--meatfish"):d.category==="乳製品・大豆製品"?l.classList.add("m-fridge__content--dairysoy"):d.category==="調味料・ソース"?l.classList.add("m-fridge__content--source"):d.category==="飲み物・デザート"?l.classList.add("m-fridge__content--dessert"):d.category==="常備食・乾物系"?l.classList.add("m-fridge__content--stock"):d.category==="主食"?l.classList.add("m-fridge__content--staple"):d.category==="手作り・作り置き"?l.classList.add("m-fridge__content--handmade"):d.category==="その他"&&l.classList.add("m-fridge__content--other"),i.appendChild(l)});const a=r.querySelector(".m-fridge__users-list");Array.isArray(n.users)&&n.users.length>0&&n.users.forEach(d=>{const l=document.createElement("p");l.classList.add("m-user-tag");const g=document.createElement("span");g.textContent=d.username,g.classList.add("m-user-tag__username"),l.appendChild(g);const f=document.createElement("button");f.type="button",f.textContent="×",f.value=d.id,f.dataset.user="remove",f.classList.add("m-user-tag__remove-btn"),l.appendChild(f);const B=a.querySelector(".m-fridge__users-more");a.insertBefore(l,B)});const s=r.querySelector(".m-fridge__users-more");s.href=`/userShare.html?fridgeId=${n.id}&fridgeName=${n.name}`;const m=r.querySelector(".m-fridge__more-link");m.href=`/fridgeDetail.html?fridgeId=${n.id}&fridgeName=${n.name}`;const p=r.querySelector(".m-fridge__remove-btn");p.value=n.id,t.appendChild(r)})}async function L(e){try{const t=await fetch(`http://localhost:8080/api/fridges/${e}`,{method:"DELETE",credentials:"include"});if(!t.ok){const n=await t.json().catch(()=>({})),r=(n==null?void 0:n.error)??(t.status===400&&"入力エラー")??"登録に失敗しました";throw new Error(r)}console.log("冷蔵庫 削除成功")}catch(t){u(t)}}async function Q(e){const t=e.value;console.log("ユーザーが入力した冷蔵庫データを取得:",JSON.stringify({itemId:t})),await L(t),await h()}async function Z(){const e=document.querySelectorAll(".m-fridge__box");e.length&&e.forEach(t=>{const n=t.querySelector("button.m-fridge__remove-btn");n.addEventListener("click",r=>{r.preventDefault(),console.log("クリック成功"),Q(n)})})}function G(){const e=document.querySelectorAll('input[name="fridgeRemoveCheck"]:checked'),t=Array.from(e).map(n=>n.value);t.length!==0&&Promise.all(t.map(n=>L(n))).then(()=>{h(),console.log("一括削除成功")}).catch(n=>{console.error("一部削除に失敗しました:",n)})}let S=!1;function K(){if(S)return;S=!0,console.log("[登録] handleRemoveSumClick 実行されました");const e=document.getElementById("fridgeRemoveSumBtn");e&&(e.addEventListener("click",t=>{console.log("[実行] 一括削除ボタンがクリックされました"),t.preventDefault(),G()}),console.log("[登録完了] 一括削除イベントを登録しました"))}async function W(e,t){const n=t.value,r=e.id.replace("fridge-","");console.log("[完了]ユーザーID削除準備:",JSON.stringify({userId:n})),console.log(r),await V(r,n),await h()}async function X(){const e=document.querySelectorAll(".m-fridge__box");e.length&&e.forEach(t=>{const n=t.querySelectorAll('button[data-user="remove"]');n.length&&n.forEach(r=>{r.addEventListener("click",o=>{o.preventDefault(),console.log("[完了]ユーザー削除クリック"),W(t,r)})})})}async function h(){if(console.log("[描画] fetchFridgeSummary 実行"),window.location.pathname!=="/fridges.html"){console.log("冷蔵庫一覧取得不要");return}try{const e=await fetch("http://localhost:8080/api/fridges/with-details",{credentials:"include"});if(!e.ok)throw new Error(`取得失敗: ステータス ${e.status}`);const t=await e.json();console.log("冷蔵庫一覧：",t),H(t),Z(),K(),X(),console.log("[描画] fetchFridgeSummary 完了")}catch(e){u(e)}}h();async function Y(e){e.reset(),e.remove(),await h()}async function ee(e,t){try{const n=await fetch("http://localhost:8080/api/fridges",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e}),credentials:"include"});if(!n.ok){const r=await n.json().catch(()=>({})),o=(r==null?void 0:r.error)??(n.status===400&&"入力エラー")??"登録に失敗しました";throw new Error(o)}console.log("冷蔵庫 新規登録成功"),await Y(t)}catch(n){u(n)}}function q(){const t=document.getElementById("fridgeItemFormTemplate").content.cloneNode(!0),n=document.createElement("div");return n.appendChild(t),n.querySelector("form")}function C(){const e=document.getElementById("fridgeItemsSortCategory");if(!e)return;const t=document.querySelectorAll(".m-fridge-detail-form");if(!t.length)return;const n=e.querySelectorAll('input[type="checkbox"]:checked'),r=Array.from(n).map(o=>o.value);t.forEach(o=>{const c=o.querySelector('select[name="fridgeItemCategory"]').value;r.includes(c)||r.includes("全て")?o.classList.remove("is-hidden"):o.classList.add("is-hidden")})}function k(){var i;const e=document.getElementById("fridgeItemsSortLimit");if(!e)return;const t=(i=e.querySelector('input[type="radio"]:checked'))==null?void 0:i.value;if(!t)return;const n=document.getElementById("fridgeItemsList");if(!n)return;const r=n.querySelectorAll(".m-fridge-detail-form");if(!r.length)return;const c=Array.from(r).map(a=>({date:a.querySelector('input[name="fridgeItemExpirationDate"]').value,i:a}));t==="降順"?c.sort((a,s)=>new Date(s.date)-new Date(a.date)):t==="昇順"&&c.sort((a,s)=>new Date(a.date)-new Date(s.date)),c.forEach(a=>n.appendChild(a.i))}function te(){if(window.location.pathname!=="/fridgeDetail.html")return;const e=document.getElementById("txtFridgeName");if(!e)return;const n=new URLSearchParams(window.location.search).get("fridgeName");e.textContent=n}te();function ne(e){const t=document.getElementById("fridgeItemsList");t.innerHTML="",e.length&&(e.forEach(n=>{const r=q();r.id="fridgeitem-"+n.id,document.getElementById("fridgeItemsAdd").after(r);const o=r.querySelector("button");o.textContent="編集",o.dataset.switch="edit",o.classList.add("m-fridge-detail-table__edit-btn");const c=r.querySelector('[name="fridgeItemCheck"]');c.value=n.id,r.querySelectorAll('input:not([type="checkbox"]), select').forEach(d=>{d.classList.add("is-disabled")});const a=r.querySelector('[name="fridgeItemName"]');a.value=n.name;const s=r.querySelector('[name="fridgeItemCategory"]');s.value=n.category;const m=r.querySelector('[name="fridgeItemExpirationDate"]');m.value=n.expirationDate?n.expirationDate:"";const p=r.querySelector('[name="fridgeItemQuantity"]');p.value=n.quantity?n.quantity:1,t.appendChild(r)}),C(),k())}function re(e,t){e.querySelectorAll("input,select").forEach(r=>{r.classList.remove("is-disabled")}),t.textContent="更新",t.dataset.switch="update"}async function oe(e,t,n,r,o){const i=new URLSearchParams(window.location.search).get("fridgeId");try{const a=await fetch(`http://localhost:8080/api/fridges/${i}/items/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,category:n,expirationDate:r,quantity:o}),credentials:"include"});if(!a.ok){const s=await a.json().catch(()=>({})),m=(s==null?void 0:s.error)??(a.status===400&&"入力エラー")??"登録に失敗しました";throw new Error("msg")}console.log("食材の更新成功"),y()}catch(a){u(a)}}function ce(e){const t=e.querySelector('[name="fridgeItemName"]').value,n=e.querySelector('[name="fridgeItemCategory"]').value,r=e.querySelector('[name="fridgeItemExpirationDate"]').value,o=e.querySelector('[name="fridgeItemQuantity"]').value,c=e.id.replace("fridgeitem-","");console.log("⭐️ 送信データ:",JSON.stringify({name:t,category:n,expirationDate:r,quantity:o})),oe(c,t,n,r,o)}function ae(e){const t=e.querySelector('button[data-switch="update"]');t&&t.addEventListener("click",n=>{n.preventDefault(),ce(e)})}function se(){const e=document.querySelectorAll(".m-fridge-detail-form");e.length>0&&e.forEach(t=>{const n=t.querySelector('button[data-switch="edit"]');n.addEventListener("click",r=>{r.preventDefault(),re(t,n),ae(t)})})}async function x(e){const n=new URLSearchParams(window.location.search).get("fridgeId");try{const r=await fetch(`http://localhost:8080/api/fridges/${n}/items/${e}`,{method:"DELETE",credentials:"include"});if(!r.ok){const o=await r.json().catch(()=>({})),c=(o==null?void 0:o.error)??(r.status===400&&"入力エラー")??"登録に失敗しました";throw new Error("msg")}console.log("食品の削除成功")}catch(r){u(r)}}async function ie(e){const t=e.id.replace("fridgeitem-","");await x(t),y()}function le(){const e=document.querySelectorAll(".m-fridge-detail-form");e.length>0&&e.forEach(t=>{t.querySelector('button[data-switch="remove"]').addEventListener("click",r=>{r.preventDefault(),ie(t)})})}function de(){const e=document.querySelectorAll('input[name="fridgeItemCheck"]:checked'),t=Array.from(e).map(n=>n.value);t.length!==0&&Promise.all(t.map(n=>x(n))).then(()=>{y()}).catch(n=>{console.error("一部削除に失敗しました:",n)})}let v=!1;function ue(){if(console.log("[登録] handleFridgeItemRemoveSumClick 実行されました"),v)return;v=!0;const e=document.getElementById("fridgeItemsRemoveSum");e&&e.addEventListener("click",t=>{console.log("[実行] 一括削除ボタンがクリックされました"),t.preventDefault(),de()}),console.log("[登録完了] 一括削除イベントを登録しました")}async function y(){if(window.location.pathname!=="/fridgeDetail.html"){console.log("fridgeItemShow.js: this is not /fridgeDetail.html, skipping fetch.");return}const t=new URLSearchParams(window.location.search).get("fridgeId");if(!t){console.error("fridgeIdが指定されていません。");return}try{const n=await fetch(`http://localhost:8080/api/fridges/${t}/items`,{credentials:"include"});if(!n.ok)throw new Error(`取得失敗: ステータス ${n.status}`);const r=await n.json();console.log(r),ne(r),se(),le(),ue(),console.log("[描画] fetchFridgeItemSummary 完了")}catch(n){u(n)}}y();async function me(e){console.log("登録フォーム",e),e.reset(),e.remove(),await y()}async function fe(e,t,n,r,o){const i=new URLSearchParams(window.location.search).get("fridgeId");console.log(i);try{const a=await fetch(`http://localhost:8080/api/fridges/${i}/items`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,category:t,expirationDate:n,quantity:r}),credentials:"include"});if(!a.ok){const s=await a.json().catch(()=>({})),m=(s==null?void 0:s.error)??(a.status===400&&"入力エラー")??"登録に失敗しました";throw new Error(m)}console.log("食材の追加に成功"),me(o)}catch(a){u(a)}}function ge(e){const t=e.querySelector('input[name="username"]').value,n=e.querySelector('input[name="email"]').value,r=e.querySelector('input[name="password"]').value,o=e.querySelector('input[name="confirmPassword"]').value;A(t,n,r,o)}function he(){const e=document.getElementById("userRegisterForm");e&&e.addEventListener("submit",t=>{t.preventDefault(),ge(e)})}he();async function ye(e){const t=e.querySelector('input[name="email"]').value,n=e.querySelector('input[name="password"]').value;await N(t,n)}function pe(){const e=document.getElementById("userLoginForm");e&&e.addEventListener("submit",t=>{t.preventDefault(),ye(e)})}pe();async function Se(e){const t=e.querySelector('input[name="userSearchEmail"]').value;t&&M(t)}let w=!1;function ve(){if(w)return;w=!0;const e=document.getElementById("usersSearchForm");e&&e.addEventListener("submit",async t=>{t.preventDefault(),console.log("送信成功"),Se(e)})}ve();function we(){const t=document.getElementById("fridgeAddFormTemplate").content.cloneNode(!0),n=document.createElement("div");return n.appendChild(t),n.querySelector("form")}function Ee(e){const t=e.querySelector('[name="fridgeName"]').value;console.log("ユーザーが入力した冷蔵庫データを取得:",JSON.stringify({name:t})),console.log(typeof t,t),ee(t,e)}function Ie(e,t){const n=e.querySelector('input[name="fridgeName"]');n.addEventListener("change",r=>{n.value?t.classList.remove("is-disabled"):t.classList.add("is-disabled")})}function Le(e){const t=e.querySelector(".m-fridge-add-form__submit");Ie(e,t),t.addEventListener("click",n=>{n.preventDefault(),Ee(e)})}function qe(){const e=we();e.querySelector("button").classList.add("is-disabled"),document.getElementById("fridgeAddContainer").appendChild(e),Le(e)}function Ce(){const e=document.getElementById("fridgeAddTriger");e&&e.addEventListener("click",t=>{t.preventDefault(),qe()})}Ce();function ke(e){const t=e.querySelector('[name="fridgeItemName"]').value,n=e.querySelector('[name="fridgeItemCategory"]').value,r=e.querySelector('[name="fridgeItemExpirationDate"]').value,o=e.querySelector('[name="fridgeItemQuantity"]').value;console.log("ユーザーが入力した食材追加データを取得:",JSON.stringify({name:t,category:n,expirationDate:r,quantity:o})),fe(t,n,r,o,e)}function xe(e){const t=e.querySelector('button[data-switch="add"]'),n=e.querySelector('[name="fridgeItemName"]'),r=e.querySelector('[name="fridgeItemCategory"]');[n,r].forEach(o=>{o.addEventListener("change",c=>{const i=n.value,a=r.value;i&&a?t.classList.remove("is-disabled"):t.classList.add("is-disabled")})}),e&&t&&t.addEventListener("click",o=>{o.preventDefault(),console.log("fridgeItemsAddForm内のaddBtnをクリック"),ke(e)})}function Be(){const e=q();e.id="fridgeItemsAddForm";const t=e.querySelector("button.m-fridge-detail-form__switch-btn");t.textContent="追加",t.dataset.switch="add",t.classList.add("is-disabled");const n=e.querySelector('button[data-switch="remove"]');n.style.opacity="0";const r=e.querySelector('[name="fridgeItemCheck"]');r.style.opacity="0",document.getElementById("fridgeItemsAddFormContainer").appendChild(e),console.log("fridgeItemsAddFormを追加"),xe(e)}function be(){const e=document.getElementById("fridgeItemsAddTriger");e&&e.addEventListener("click",t=>{t.preventDefault(),Be()})}be();function _e(){const e=document.getElementById("fridgeItemsSortCategory");if(!e)return;const t=e.querySelectorAll(".m-fridge-detail-sort__item");t&&t.forEach(n=>{n.querySelector('input[type="checkbox"]').addEventListener("change",o=>{C()})})}_e();function Fe(){const e=document.getElementById("fridgeItemsSortLimit");if(!e)return;const t=e.querySelectorAll(".m-fridge-detail-sort__item");t&&t.forEach(n=>{n.querySelector('input[type="radio"]').addEventListener("change",o=>{k()})})}Fe();function Pe(){const e=document.querySelectorAll(".js-valid-password");e.length&&e.forEach(t=>{t.addEventListener("change",()=>{const n=t.nextElementSibling;n&&n.classList.contains("is-validError")&&n.remove();const r=t.value;if(r&&!/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{8,}$/.test(r)){const c=document.createElement("p");c.classList.add("is-validError"),t.after(c),c.textContent="半角数字のみの8文字以上で入力してください。"}})})}Pe();function Ae(){const e=document.querySelectorAll(".js-valid-password");e.length&&e.forEach(t=>{let n=null;const o=t.closest(".m-form__group").nextElementSibling;o&&o.classList.contains("m-form__group")&&(n=o.querySelector(".js-valid-password-confirm")),n&&n.addEventListener("change",()=>{const c=n.nextElementSibling;c&&c.classList.contains("is-validError")&&c.remove();const i=t.value,a=n.value;if(i&&a&&a!==i){const s=document.createElement("p");s.classList.add("is-validError"),n.after(s),s.textContent="パスワードが一致していません"}})})}Ae();console.log("API_BASE:","http://localhost:8080/api");
